<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_picking_form_inherit" model="ir.ui.view">
        <field name="name">view.picking.form.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='picking_type_id']" position="after">
               <field name="approval_temp_id" readonly="1" attrs="{'invisible':[('approval_temp_id','=',False)]}"/>
               <field name="submit_approval" invisible="1"/>
               <field name="fully_approved" invisible="1"/>
               <field name="valid_for_approval"  invisible="1"/>
               <field name="valid_for_reject"  invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='state']" position="after">
                <field name="new_state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,done"/>
            </xpath>

            <xpath expr="//button[@name='button_validate']" position="after">
                <button name="button_submit_approval" 
                        attrs="{'invisible': ['|',('approval_temp_id', '=', False),('submit_approval','=',True)]}" 
                        string="Submit for Approval" 
                        type="object" 
                        class="oe_highlight"/>

                <button name="action_approve" 
                    string="Approve"
                    type="object" 
                    class="btn-primary"
                    attrs="{'invisible':['|',('valid_for_approval','=',False),('new_state','!=','need_approval')]}"/>

                <button name="action_reject" 
                    string="Reject"
                    type="object" 
                    class="btn-primary"  attrs="{'invisible':['|',('valid_for_reject','=',False),('new_state','!=','need_approval')]}"/>
            </xpath>

            <xpath expr="//page[@name='note']" position="after">
                <page name="approvals" string="Approvals" attrs="{'invisible':[('approval_temp_id','=',False)]}">
                    <group>
                        <field name="approval_line_ids" nolabel="1" readonly="1" >
                            <tree editable="bottom" decoration-primary="status=='submitted'" decoration-success="status=='approved'" decoration-danger="status=='reject'">
                                <field name="name" string="Role"/>
                                <field name="approved_by"/>
                                <field name="status"/>
                                <field name="approval_date"/>
                                <field name="approval_stage_id" invisible="1"/>
                                <field name="req_user_ids" widget="many2many_tags"/>
                            </tree>
                            <form>
                                <sheet>
                                    <group>
                                        <group>
                                            <field name="name" string="Role"/>
                                            <field name="status"/>
                                            <field name="approval_stage_id"/>
                                        </group>
                                        <group>
                                            <field name="req_user_ids" widget="many2many_tags"/>
                                            <field name="approved_by"/>
                                            <field name="approval_date"/>
                                        </group>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </group>                    
                </page>
                <page string="Approval History" name="approval_history" attrs="{'invisible':[('approval_temp_id','=',False)]}">
                    <group>                        
                        <field name="approval_history_ids" nolabel="1" readonly="1" >
                            <tree>
                                <field name="name" string="Role"/>
                                <field name="approved_by" string="Updated By"/>
                                <field name="status"/>
                                <field name="approval_date"/>
                                <field name="approval_stage_id" invisible="1"/>
                            </tree>
                            <form>
                                <field name="name" string="Role"/>
                                <field name="approved_by" string="Updated By"/>
                                <field name="status"/>
                                <field name="approval_date"/>
                                <field name="approval_stage_id" invisible="1"/>
                            </form>
                        </field>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_picking_type_form_inherit" model="ir.ui.view">
        <field name="name">view.picking.type.form.inherit</field>
        <field name="model">stock.picking.type</field>
        <field name="inherit_id" ref="stock.view_picking_type_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='warehouse_id']" position="after">
                <field name="type_approval_id" string="Approval Template"/>
            </xpath>
        </field>
    </record>
</odoo>